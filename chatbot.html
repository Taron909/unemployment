<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <!-- viewport meta æ¨™ç±¤æ˜¯éŸ¿æ‡‰å¼è¨­è¨ˆçš„åŸºç¤ï¼Œå®ƒå‘Šè¨´ç€è¦½å™¨é é¢æ‡‰å¦‚ä½•ç¸®æ”¾ä»¥é©æ‡‰è¨­å‚™å¯¬åº¦ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºèƒ½è«®è©¢å®¤ï½œæ•¸æ“šä¹‹ä¸‹çš„ç¾å¯¦ï¼šé‡æ–°èªè­˜å°ç£å¤±æ¥­ç‡</title>
  <!-- å¼•å…¥ W3.CSS æ¨£å¼åº«ï¼Œç”¨æ–¼å°è¦½åˆ—å’Œé€šç”¨æ’ç‰ˆ -->
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <!-- å¼•å…¥ Google Fonts çš„æ€æºé»‘é«”ï¼Œä½œç‚ºä¸»è¦å­—é«” -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+TC">
  <!-- å¼•å…¥ Tailwind CSS CDNï¼Œç”¨æ–¼å¿«é€Ÿé€ å‹ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /*
     * é€šç”¨æ¨£å¼è¨­å®š
     * è¨­å®šå…¨ç«™å­—é«”ã€èƒŒæ™¯è‰²ã€æ¨™é¡Œèˆ‡å°è¦½åˆ—æ¨£å¼
     */
    body {
      font-family: 'Noto Sans TC', sans-serif; /* å…¨ç«™å­—é«”ä½¿ç”¨æ€æºé»‘é«” */
      background-color: #fdfcd9; /* èƒŒæ™¯è‰²ç‚ºæŸ”å’Œéµé»ƒè‰² */
      margin: 0;
      padding: 0;
    }
    h2 {
      color: #21409a; /* æ¨™é¡Œæ–‡å­—è‰²ç‚ºæ·±è—è‰² */
      margin-top: 40px;
    }
    canvas {
      max-width: 100%; /* åœ–è¡¨å¯¬åº¦éš¨å®¹å™¨èª¿æ•´ (æ­¤é é¢é›–ç„¡ canvasï¼Œä½†ç‚ºé€šç”¨æ¨£å¼) */
      margin-bottom: 40px;
    }
    .header {
      background-color: #21409a; /* é é¦–èƒŒæ™¯ç‚ºæ·±è—è‰² */
      color: white; /* æ–‡å­—é¡è‰²ç‚ºç™½è‰² */
      text-align: center; /* æ–‡å­—ç½®ä¸­ */
      padding: 30px 0; /* ä¸Šä¸‹å…§é‚Šè· */
      font-size: 2em; /* å­—é«”å¤§å° */
      font-weight: bold; /* å­—é«”åŠ ç²— */
    }
    /* === å°è¦½åˆ—æ¨£å¼è¨­å®š === */
    nav {
      background-color: #21409a; /* å°è¦½åˆ—èƒŒæ™¯ç‚ºæ·±è—è‰² */
      display: flex; /* ä½¿ç”¨ Flexbox ä½ˆå±€ */
      flex-wrap: wrap;             /* å°è¦½åˆ—æ›è¡Œä»¥é¿å…å¯¬åº¦è¶…å‡ºï¼Œå¯¦ç¾éŸ¿æ‡‰å¼ */
      justify-content: center; /* å°è¦½é …ç›®æ°´å¹³ç½®ä¸­ */
    }
    
    nav a {
      display: inline-block; /* è®“é€£çµåƒå€å¡Šä¸€æ¨£å¯ä»¥è¨­å®šå¯¬é«˜ */
      line-height: 2em; /* è¡Œé«˜ */
      padding: 30px 50px; /* å…§é‚Šè· */
      color: white; /* æ–‡å­—é¡è‰²ç‚ºç™½è‰² */
      text-decoration: none; /* ç§»é™¤åº•ç·š */
      font-weight: bold; /* å­—é«”åŠ ç²— */
      white-space: nowrap;         /* é˜²æ­¢æ–‡å­—æ›è¡Œ */
      /* è‡ªå‹•ç¸®æ”¾å­—é«”å¤§å°ï¼šè¦–çª—è¶Šå°å­—è¶Šå°ï¼Œä¿æŒå¯è®€æ€§ */
      font-size: clamp(0.9em, 2.5vw, 1.3em); 
    }
    
    nav a:hover {
      background-color: #880e4f; /* æ»‘é¼ æ»‘éç‚ºé…’ç´…è‰² */
    }
    .w3-bar .active {
      background-color: #800080 !important; /* æ¨™ç¤ºç•¶å‰é é¢ç‚ºç´«è‰² */
      color: white !important; /* æ–‡å­—é¡è‰²ç‚ºç™½è‰² */
    }
    /*
     * é å°¾æ¨£å¼
     * å›ºå®šåœ¨åº•éƒ¨ï¼Œç¢ºä¿åœ¨å…§å®¹è¼ƒçŸ­æ™‚é å°¾ä¹Ÿèƒ½é¡¯ç¤ºåœ¨æ­£ç¢ºä½ç½®
     */
    .footer {
      background-color: #21409a; /* é å°¾èƒŒæ™¯ç‚ºæ·±è—è‰² */
      color: white; /* æ–‡å­—é¡è‰²ç‚ºç™½è‰² */
      text-align: center; /* æ–‡å­—ç½®ä¸­ */
      padding: 16px; /* å…§é‚Šè· */
      font-size: 0.95em; /* å­—é«”å¤§å° */
      position: fixed;   /* å›ºå®šä½ç½® */
      bottom: 0;         /* è²¼é½Šåº•éƒ¨ */
      left: 0;
      width: 100%; /* å¯¬åº¦ä½”æ»¿ */
      z-index: 10; /* ç¢ºä¿é å°¾åœ¨å…¶ä»–å…§å®¹ä¹‹ä¸Š */
      line-height:5px;  
    }
    .footer a {
      color: white; /* é€£çµæ–‡å­—é¡è‰²ç‚ºç™½è‰² */
      text-decoration: underline; /* é€£çµå¸¶åº•ç·š */
    }
    main {
      max-width: 1200px; /* ä¸»å…§å®¹å€å¡Šæœ€å¤§å¯¬åº¦ */
      margin: 40px auto; /* ä¸Šä¸‹å¤–é‚Šè· 40pxï¼Œå·¦å³è‡ªå‹• (ç½®ä¸­) */
      /* ç‚º main åº•éƒ¨æ·»åŠ è¶³å¤ çš„ paddingï¼Œé˜²æ­¢è¢«å›ºå®šé å°¾é®è“‹ */
      padding: 0 20px 80px 20px; /* å·¦å³å…§é‚Šè·ï¼Œåº•éƒ¨é¡å¤–ç•™ç™½ */
    }
    /* ===== æ®µè½ä»‹ç´¹æ¨£å¼ (åœ¨ chatbot é é¢ä¸­æœªä½¿ç”¨ï¼Œä½†ä¿ç•™) ===== */
    .section {
      display: flex;
      flex-wrap: wrap;             /* æ›è¡Œæ”¯æ´ */
      justify-content: center;     /* å€å¡Šæ°´å¹³ç½®ä¸­ */
      padding: 5px;                /* å€å¡Šç•™ç™½ */
      gap: 30px;                   /* å€å¡Šé–“è· */
    }
    .section-text {
      flex: 1.2;
      max-width: 1200px;           /* é™åˆ¶æ–‡å­—æœ€å¤§å¯¬åº¦ */
      margin: 0 auto;
    }
    .section-text h2 {
      font-weight: bold;
      font-size: 1.2em;
      margin-left: 5%;             /* å·¦é‚Šç•™ç™½ */
      max-width: 900px;            /* æ–‡å­—ä¸è¶…å‡ºå®¹å™¨ */
    }
    .section-text p {
      margin-left: 10%;
      max-width: 700px;
      font-size: 1.2em;
      line-height: 1.5em; /* èª¿æ•´è¡Œé«˜ä»¥é¿å…æ–‡å­—é‡ç–Šï¼ŒåŸ 0.5em éå° */
    }
    /* ===== ç¿»è½‰å¡ç‰‡æ¨£å¼ (åœ¨ chatbot é é¢ä¸­æœªä½¿ç”¨ï¼Œä½†ä¿ç•™) ===== */
    .flip-card {
      background-color: transparent;
      width: 100%;
      max-width: 1200px;
      margin: 40px auto;
      perspective: 1000px;
    }
    .card-content {
      display: flex;
      flex-direction: row;
      align-items: center;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      padding: 20px;
      gap: 20px;
      transform: rotateY(0);
      transition: transform 0.8s;
    }
    .card-image {
      flex: 0 0 240px;
    }
    .card-image img {
      width: 100%;
      border-radius: 8px;
    }
    .card-text {
      flex: 1;
      font-size: 1.2em;
      line-height: 2.5em;
    }
    .card-text b {
      color: #880e4f;
    }
    /* ===== é é¢å°è¦½æŒ‰éˆ•æ¨£å¼ (åœ¨ chatbot é é¢ä¸­æœªä½¿ç”¨ï¼Œä½†ä¿ç•™) ===== */
    .nav-buttons {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 40px 0;
      gap: 40px;
    }
    .nav-buttons button {
      background-color: transparent;
      border: none;
      font-size: 2em;
      cursor: pointer;
    }
    .page {
      display: none;
    }
    .page.active {
      display: block;
      animation: flip 0.6s ease;
    }
    @keyframes flip {
      from { transform: rotateY(-90deg); opacity: 0; }
      to { transform: rotateY(0); opacity: 1; }
    }
    @media screen and (max-width: 768px) {
      .card-content {
        flex-direction: column;
      }
      .card-image {
        flex: unset;
        width: 100%;
      }
    }

    /* === Gemini èŠå¤©æ‡‰ç”¨ç¨‹å¼æ¨£å¼ === */
    .gemini-chat-body {
        font-family: 'Inter', sans-serif; /* ä½¿ç”¨ Inter å­—é«” */
    }
    /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ */
    /* é€™äº›æ»¾å‹•æ¢æ¨£å¼ç¾åœ¨å°‡æ‡‰ç”¨æ–¼æ•´å€‹é é¢ */
    ::-webkit-scrollbar {
        width: 8px; /* æ»¾å‹•æ¢å¯¬åº¦ */
    }
    ::-webkit-scrollbar-track {
        background: #f1f1f1; /* æ»¾å‹•æ¢è»Œé“èƒŒæ™¯è‰² */
        border-radius: 10px; /* åœ“è§’ */
    }
    ::-webkit-scrollbar-thumb {
        background: #888; /* æ»¾å‹•æ¢æ»‘å¡ŠèƒŒæ™¯è‰² */
        border-radius: 10px; /* åœ“è§’ */
    }
    ::-webkit-scrollbar-thumb:hover {
        background: #555; /* æ»¾å‹•æ¢æ»‘å¡Šæ‡¸åœèƒŒæ™¯è‰² */
    }

    /* å…§åµŒèŠå¤©å®¹å™¨ */
    .inline-chat-container {
        margin: 40px auto; /* æ°´å¹³ç½®ä¸­ï¼Œä¸Šä¸‹å¤–é‚Šè· */
        width: 100%; /* å¯¬åº¦ä½”æ»¿çˆ¶å®¹å™¨ */
        max-width: 800px; /* èª¿æ•´ç‚ºæ›´å¯¬çš„æœ€å¤§å¯¬åº¦ */
        min-height: 600px; /* æ–°å¢æœ€å°é«˜åº¦ */
        display: flex; /* Flexbox ä½ˆå±€ */
        flex-direction: column; /* å‚ç›´æ’åˆ—å­å…ƒç´  */
        background-color: white; /* ç™½è‰²èƒŒæ™¯ */
        border-radius: 1rem; /* åœ“è§’ */
        box-shadow: 0 10px 15px rgba(0,0,0,0.1); /* é™°å½± */
        /* ç§»é™¤ overflow: hiddenï¼Œè®“å…§å®¹å¯ä»¥è¶…å‡ºå®¹å™¨ä¸¦ç”±é é¢æ»¾å‹• */
    }

    /* èŠå¤©è¨Šæ¯é¡¯ç¤ºå€åŸŸ */
    .chat-messages {
        flex-1; /* è®“èŠå¤©è¨Šæ¯å€å¡Šå½ˆæ€§ä½”ç”¨å‰©é¤˜ç©ºé–“ */
        overflow-y: auto; /* å‚ç›´æ»¾å‹•æ¢ï¼Œç•¶å…§å®¹æº¢å‡ºæ™‚é¡¯ç¤º */
        padding: 6px; /* å…§é‚Šè· */
        /* space-y-4 æ˜¯ Tailwind classï¼Œå¦‚æœç´” CSS æ‡‰è½‰æ›ç‚º margin-bottom */
        /* background-color: #f9fafb; /* æ·ºç°è‰²èƒŒæ™¯ */
    }
    /* ç‚º chat-messages å…§çš„æ¯å€‹è¨Šæ¯æ·»åŠ é–“è·ï¼Œå› ç‚º space-y-4 ä¸æ˜¯ç´” CSS */
    .chat-messages > div + div {
        margin-top: 1rem; /* ç­‰åŒæ–¼ space-y-4 */
    }


    /* éŸ¿æ‡‰å¼èª¿æ•´å…§åµŒèŠå¤©å®¹å™¨ */
    @media (max-width: 480px) {
        .inline-chat-container {
            width: 90%; /* åœ¨å°è¢å¹•ä¸Šèª¿æ•´ç‚º 90% å¯¬åº¦ */
        }
        /* èª¿æ•´ main å…ƒç´ åœ¨å°è¢å¹•ä¸Šçš„ paddingï¼Œé¿å…èŠå¤©å®¤å…§å®¹éæ–¼è²¼é‚Š */
        main {
            padding: 20px 10px 80px 10px; /* ç¸®å°å·¦å³å…§é‚Šè· */
        }
    }
    /* å°è¦½åˆ—åœ¨å°è¢å¹•ä¸Šçš„èª¿æ•´ */
    @media screen and (max-width: 768px) {
      nav {
        flex-direction: column; /* å°è¦½åˆ—æŒ‰éˆ•åœ¨å°è¢å¹•ä¸Šæ”¹ç‚ºå‚ç›´æ’åˆ— */
      }
      nav a {
        padding: 15px 20px; /* ç¸®å°å°è¦½åˆ—æŒ‰éˆ•çš„å¡«å…… */
      }
    }
  </style>
</head>
<body class="gemini-chat-body">
  <header class="header">æ•¸æ“šä¹‹ä¸‹çš„ç¾å¯¦ï¼šé‡æ–°èªè­˜å°ç£å¤±æ¥­ç‡</header>
  <!-- å°è¦½åˆ—å€å¡Šï¼šæä¾›é é¢é–“çš„å°è¦½åŠŸèƒ½ -->
  <nav class="w3-bar w3-indigo">
    <div class="nav-wrapper" style="display: flex; justify-content: center; gap: 0px;">
      <!-- å°è¦½åˆ—æŒ‰éˆ•ï¼šé¦–é ï¼Œé»æ“Šæœƒå°å‘ index.html -->
      <a href="index.html" class="w3-bar-item w3-button w3-hover-white">é¦–é </a>
      <!-- å°è¦½åˆ—æŒ‰éˆ•ï¼šè¶¨å‹¢åˆ†æï¼Œé»æ“Šæœƒå°å‘ trend.html -->
      <a href="trend.html" class="w3-bar-item w3-button w3-hover-white">è¶¨å‹¢åˆ†æ</a>
      <!-- å°è¦½åˆ—æŒ‰éˆ•ï¼šåœ‹å®¶æ”¿ç­–ï¼Œé»æ“Šæœƒå°å‘ policy.html -->
      <a href="policy.html" class="w3-bar-item w3-button w3-hover-white">åœ‹å®¶æ”¿ç­–</a>
      <!-- å°è¦½åˆ—æŒ‰éˆ•ï¼šå¯¦éš›æ¡ˆä¾‹ï¼Œé»æ“Šæœƒå°å‘ case.html -->
      <a href="case.html" class="w3-bar-item w3-button w3-hover-white">å¯¦éš›æ¡ˆä¾‹</a>
      <!-- å°è¦½åˆ—æŒ‰éˆ•ï¼šæ™ºèƒ½è«®è©¢å®¤ï¼Œé»æ“Šæœƒå°å‘ chatbot.htmlï¼Œä¸¦æ¨™ç¤ºç‚ºç•¶å‰æ´»èºé é¢ -->
      <a href="chatbot.html" class="w3-bar-item w3-button w3-hover-white active">æ™ºèƒ½è«®è©¢å®¤</a>
    </div>
  </nav>
  <main>
    <!-- Gemini èŠå¤©æ‡‰ç”¨ç¨‹å¼æ•´åˆ -->
    <div id="inline-chat-container" class="inline-chat-container">
      <!-- èŠå¤©æ¨™é¡Œ -->
      <div class="p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white text-center text-2xl font-bold rounded-t-xl shadow-md">
        Gemini èŠå¤©å®¤
      </div>

      <!-- èŠå¤©è¨Šæ¯é¡¯ç¤ºå€åŸŸ -->
      <div id="chat-messages" class="chat-messages flex-1 overflow-y-auto p-6 bg-gray-50">
        <!-- è¨Šæ¯å°‡æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
        <div class="flex justify-start">
          <div class="bg-blue-100 text-blue-800 p-3 rounded-lg max-w-[80%] shadow-sm">
            å—¨ï¼æˆ‘æ˜¯ Geminiï¼Œæœ‰ä»€éº¼æˆ‘å¯ä»¥å¹«åŠ©ä½ çš„å—ï¼Ÿ
          </div>
        </div>
      </div>

      <!-- è¼‰å…¥æŒ‡ç¤ºå™¨ -->
      <div id="loading-indicator" class="hidden flex justify-center items-center py-2">
        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
        <span class="ml-2 text-gray-600">Gemini æ­£åœ¨æ€è€ƒ...</span>
      </div>

      <!-- è¨Šæ¯è¼¸å…¥å€åŸŸ -->
      <div class="p-4 border-t border-gray-200 flex items-center bg-white rounded-b-xl">
        <textarea
          id="user-input"
          class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none h-12 overflow-hidden transition-all duration-200"
          placeholder="è¼¸å…¥ä½ çš„è¨Šæ¯..."
          rows="1"
        ></textarea>
        <button
          id="send-button"
          class="ml-3 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75 transition-colors duration-200"
        >
          å‚³é€
        </button>
      </div>
    </div>
  </main>
  <!-- é å°¾å€å¡Šï¼šè¯çµ¡è³‡è¨Šèˆ‡ç‰ˆæ¬Šè²æ˜ -->
  <footer class="footer">
    ğŸ“© å¯„ä¿¡çµ¦æˆ‘ æ—å®¸ç·¯ <a href="#" onclick="openGmail()">blue8841269@gmail.com</a>
  </footer>
  
  <script type="module">
    // å–å¾— DOM å…ƒç´ 
    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const loadingIndicator = document.getElementById('loading-indicator');

    // èŠå¤©è¨˜éŒ„
    let chatHistory = [];

    // æ·»åŠ è¨Šæ¯åˆ°èŠå¤©å®¤
    function addMessage(sender, text) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('flex', sender === 'user' ? 'justify-end' : 'justify-start');

        const messageBubble = document.createElement('div');
        // ä¿®æ­£ï¼šå°‡é¡åˆ¥åç¨±åˆ†é–‹æ·»åŠ ï¼Œé¿å… InvalidCharacterError
        const commonClasses = ['p-3', 'rounded-lg', 'max-w-[80%]', 'shadow-sm'];
        const senderClasses = sender === 'user' ? ['bg-blue-500', 'text-white'] : ['bg-gray-200', 'text-gray-800'];
        messageBubble.classList.add(...commonClasses, ...senderClasses);
        
        messageBubble.textContent = text;

        messageDiv.appendChild(messageBubble);
        chatMessages.appendChild(messageDiv);

        // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨
        chatMessages.scrollTop = chatMessages.scrollHeight;
        // å¦‚æœèŠå¤©å®¤å…§å®¹å°è‡´æ•´å€‹é é¢æ»¾å‹•ï¼Œç¢ºä¿é é¢ä¹Ÿæ»¾å‹•åˆ°åº•éƒ¨
        window.scrollTo(0, document.body.scrollHeight); 
    }

    // è™•ç†å‚³é€è¨Šæ¯
    async function sendMessage() {
        const prompt = userInput.value.trim();
        if (!prompt) return;

        addMessage('user', prompt);
        userInput.value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†
        loadingIndicator.classList.remove('hidden'); // é¡¯ç¤ºè¼‰å…¥æŒ‡ç¤ºå™¨
        sendButton.disabled = true; // ç¦ç”¨å‚³é€æŒ‰éˆ•
        userInput.disabled = true; // ç¦ç”¨è¼¸å…¥æ¡†

        chatHistory.push({ role: "user", parts: [{ text: prompt }] });

        const payload = { contents: chatHistory };
        const apiKey = "AIzaSyBoFmlsnaABMBbn-r3w_49SzZlksRrHazA"; // å·²æ›´æ–°ç‚ºæ‚¨æä¾›çš„é‡‘é‘°
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        let retries = 0;
        const maxRetries = 5;
        const initialDelay = 1000; // 1ç§’

        while (retries < maxRetries) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    // å¦‚æœæ˜¯ 429 Too Many Requests éŒ¯èª¤ï¼Œå‰‡é‡è©¦
                    if (response.status === 429) {
                        const delay = initialDelay * Math.pow(2, retries);
                        console.warn(`æ”¶åˆ° 429 éŒ¯èª¤ï¼Œå°‡åœ¨ ${delay / 1000} ç§’å¾Œé‡è©¦...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        retries++;
                        continue; // ç¹¼çºŒä¸‹ä¸€æ¬¡å¾ªç’°é€²è¡Œé‡è©¦
                    } else {
                        throw new Error(`API éŒ¯èª¤: ${response.status} ${response.statusText}`);
                    }
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const geminiResponse = result.candidates[0].content.parts[0].text;
                    addMessage('gemini', geminiResponse);
                    chatHistory.push({ role: "model", parts: [{ text: geminiResponse }] });
                } else {
                    addMessage('gemini', 'æŠ±æ­‰ï¼Œæˆ‘ç„¡æ³•ç†è§£ä½ çš„å•é¡Œã€‚');
                    console.error('Gemini API å›æ‡‰çµæ§‹ä¸ç¬¦é æœŸ:', result);
                }
                break; // æˆåŠŸå¾Œè·³å‡ºå¾ªç’°
            } catch (error) {
                console.error('å‘¼å« Gemini API æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                addMessage('gemini', 'æŠ±æ­‰ï¼Œèˆ‡ Gemini é€£ç·šæ™‚ç™¼ç”ŸéŒ¯èª¤ã€‚è«‹ç¨å¾Œå†è©¦ã€‚');
                break; // å‡ºç¾å…¶ä»–éŒ¯èª¤æ™‚ä¹Ÿè·³å‡ºå¾ªç’°
            } finally {
                loadingIndicator.classList.add('hidden'); // éš±è—è¼‰å…¥æŒ‡ç¤ºå™¨
                sendButton.disabled = false; // å•Ÿç”¨å‚³é€æŒ‰éˆ•
                userInput.disabled = false; // å•Ÿç”¨è¼¸å…¥æ¡†
                userInput.focus(); // è¼¸å…¥æ¡†é‡æ–°ç²å¾—ç„¦é»
            }
        }
    }

    // ç›£è½å‚³é€æŒ‰éˆ•é»æ“Šäº‹ä»¶
    sendButton.addEventListener('click', sendMessage);

    // ç›£è½ Enter éµç›¤äº‹ä»¶
    userInput.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault(); // é˜²æ­¢æ›è¡Œ
            sendMessage();
        }
    });

    // è‡ªå‹•èª¿æ•´ textarea é«˜åº¦
    userInput.addEventListener('input', () => {
        userInput.style.height = 'auto';
        userInput.style.height = userInput.scrollHeight + 'px';
    });

    // ä»¥ä¸‹æ˜¯ TTS ç›¸é—œçš„è¼”åŠ©å‡½æ•¸ï¼Œç›®å‰æœªä½¿ç”¨ï¼Œä½†å¯ä¾›æœªä¾†æ“´å±•
    function base64ToArrayBuffer(base64) {
        const binaryString = window.atob(base64);
        const len = binaryString.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        return bytes.buffer;
    }

    function pcmToWav(pcmData, sampleRate) {
        const numChannels = 1; // å–®è²é“
        const bytesPerSample = 2; // 16 ä½å…ƒ PCM

        const wavHeader = new ArrayBuffer(44);
        const view = new DataView(wavHeader);

        // RIFF chunk
        writeString(view, 0, 'RIFF');
        view.setUint32(4, 36 + pcmData.byteLength, true); // ChunkSize
        writeString(view, 8, 'WAVE');

        // FMT chunk
        writeString(view, 12, 'fmt ');
        view.setUint32(16, 16, true); // Subchunk1Size (16 for PCM)
        view.setUint16(20, 1, true); // AudioFormat (1 for PCM)
        view.setUint16(22, numChannels, true);
        view.setUint32(24, sampleRate, true);
        view.setUint32(28, sampleRate * numChannels * bytesPerSample, true); // ByteRate
        view.setUint16(32, numChannels * bytesPerSample, true); // BlockAlign
        view.setUint16(34, bytesPerSample * 8, true); // BitsPerSample

        // DATA chunk
        writeString(view, 36, 'data');
        view.setUint32(40, pcmData.byteLength, true); // Subchunk2Size

        const blob = new Blob([wavHeader, pcmData], { type: 'audio/wav' });
        return blob;
    }

    function writeString(view, offset, string) {
        for (let i = 0; i < string.length; i++) {
            view.setUint8(offset + i, string.charCodeAt(i));
        }
    }

    /**
     * @description é–‹å•Ÿ Gmail æ’°å¯«æ–°éƒµä»¶è¦–çª—ï¼Œä¸¦é è¨­æ”¶ä»¶äººã€ä¸»æ—¨åŠå…§æ–‡ã€‚
     */
    function openGmail() {
      const email = "blue8841269@gmail.com";
      const subject = encodeURIComponent("ä¸»æ—¨é è¨­æ–‡å­—");
      const body = encodeURIComponent("æ‚¨å¥½ï¼Œæˆ‘æƒ³äº†è§£æœ‰é—œå°ç£å¤±æ¥­ç‡è³‡æ–™çš„æ›´å¤šç´°ç¯€...");
      const gmailURL = `https://mail.google.com/mail/?view=cm&fs=1&to=${email}&su=${subject}&body=${body}`;
      window.open(gmailURL, '_blank');
    }
  </script>
</body>
</html>
